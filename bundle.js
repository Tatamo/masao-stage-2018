!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e){t.exports=PIXI},function(t,e){var s=4,i=.001,a=1e-7,n=10,r=11,h=1/(r-1),p="function"==typeof Float32Array;function o(t,e){return 1-3*e+3*t}function l(t,e){return 3*e-6*t}function c(t){return 3*t}function d(t,e,s){return((o(e,s)*t+l(e,s))*t+c(e))*t}function u(t,e,s){return 3*o(e,s)*t*t+2*l(e,s)*t+c(e)}function m(t){return t}t.exports=function(t,e,o,l){if(!(0<=t&&t<=1&&0<=o&&o<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&o===l)return m;for(var c=p?new Float32Array(r):new Array(r),f=0;f<r;++f)c[f]=d(f*h,t,o);function g(e){for(var p=0,l=1,m=r-1;l!==m&&c[l]<=e;++l)p+=h;var f=p+(e-c[--l])/(c[l+1]-c[l])*h,g=u(f,t,o);return g>=i?function(t,e,i,a){for(var n=0;n<s;++n){var r=u(e,i,a);if(0===r)return e;e-=(d(e,i,a)-t)/r}return e}(e,f,t,o):0===g?f:function(t,e,s,i,r){var h,p,o=0;do{(h=d(p=e+(s-e)/2,i,r)-t)>0?s=p:e=p}while(Math.abs(h)>a&&++o<n);return p}(e,p,p+h,t,o)}return function(t){return 0===t?0:1===t?1:d(g(t),e,l)}}},function(t){t.exports={"masao-json-format-version":"draft-4",params:{backcolor_blue:"96",backcolor_green:"48",audio_bgm_switch_ogg:"2",audio_se_switch_ogg:"2",audio_se_switch_wave:"2",filename_chizu:"chizu.gif",filename_ending:"ending.gif",filename_gameover:"gameover.gif",filename_haikei:"haikei.gif",filename_haikei2:"haikei.gif",filename_haikei3:"haikei.gif",filename_haikei4:"haikei.gif",filename_mapchip:"mapchip.gif",filename_pattern:"pattern.gif",filename_title:"title.gif",time_max:"0","map0-0":".."},version:"fx16","advanced-map":{stages:[{size:{x:16,y:10},layers:[{type:"main",map:[[],[],[],[],[],[],[],[],[0,65],[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100]]},{type:"mapchip",map:[]}]}]},_meme_core:{customParts:{}},metadata:{editor:"uhyo-masao-editor"},"_uhyo-masao-editor":{version:1,fingerprint:"lp847nrntus",media:{},id:"xtd5n5rh2w"}}},function(t){t.exports=[{name:"pattern",path:"assets/images/pattern.json"},{name:"title_image",path:"assets/images/title.gif"},{name:"gameover_image",path:"assets/images/gameover.gif"},{name:"ending_image",path:"assets/images/ending.gif"},{name:"health_bar_image",path:"assets/images/health_bar.png"},{name:"bullet_blue_image",path:"assets/images/bullet_blue.png"},{name:"bullet_blue_large_image",path:"assets/images/bullet_blue_large.png"},{name:"bullet_red_image",path:"assets/images/bullet_red.png"},{name:"long_bullet_image",path:"assets/images/long_bullet.png"},{name:"slit_image",path:"assets/images/slit.png"},{name:"shockwave_image",path:"assets/images/shockwave.png"},{name:"shockwave_jaggy_image",path:"assets/images/shockwave_jaggy.png"},{name:"shockwave_asymmetry_image",path:"assets/images/shockwave_asymmetry.png"},{name:"shield_image",path:"assets/images/shield.png"},{name:"ring_image",path:"assets/images/ring.png"},{name:"bakuhatu_sound",path:"assets/sounds/bakuhatu.mp3"},{name:"clear_sound",path:"assets/sounds/clear.mp3"},{name:"coin_sound",path:"assets/sounds/coin.mp3"},{name:"dosun_sound",path:"assets/sounds/dosun.mp3"},{name:"fumu_sound",path:"assets/sounds/fumu.mp3"},{name:"gameover_sound",path:"assets/sounds/gameover.mp3"},{name:"get_sound",path:"assets/sounds/get.mp3"},{name:"happa_sound",path:"assets/sounds/happa.mp3"},{name:"item_sound",path:"assets/sounds/item.mp3"},{name:"jump_sound",path:"assets/sounds/jump.mp3"},{name:"kiki_sound",path:"assets/sounds/kiki.mp3"},{name:"mgan_sound",path:"assets/sounds/mgan.mp3"},{name:"mizu_sound",path:"assets/sounds/mizu.mp3"},{name:"shot_sound",path:"assets/sounds/shot.mp3"},{name:"sjump_sound",path:"assets/sounds/sjump.mp3"},{name:"stage1_sound",path:"assets/sounds/stage1.mp3"},{name:"title_sound",path:"assets/sounds/title.mp3"},{name:"tobasu_sound",path:"assets/sounds/tobasu.mp3"},{name:"charge1_sound",path:"assets/sounds/attack2.mp3"},{name:"charge2_sound",path:"assets/sounds/powerup02.mp3"},{name:"shield_sound",path:"assets/sounds/strange_wave.mp3"},{name:"trace_sound",path:"assets/sounds/magic_elevator.mp3"},{name:"laser_sound",path:"assets/sounds/beam2.mp3"}]},function(t,e,s){"use strict";s.r(e);var i=s(2),a=s(3);class n{constructor(){this.wait=!0}go(){this.wait=!1}inject(t,e){const s=this,i=t.userInit;t.userInit=function(){i.apply(t);const e=t.run;t.run=function(){1===t.th_jm&&s.wait?t.__repaint():e.apply(t)}}}}var r=s(0);class h{get alive(){return this._alive}get container(){return this._container}get size(){return this.children.length}constructor(t,e=!0){this._alive=!0,e?(this._container=new r.Container,t.addChild(this._container)):this._container=t,this.children=[]}add(t){this._container.addChild(t.container),this.children.push(t)}update(){const t=this.children.length;for(let e=0;e<t;e++){const t=this.children[e];null!==t&&t.update()}for(let t=0;t<this.children.length;t++)null===this.children[t]||this.children[t].alive||(this.children[t].container.visible=!1,this._container.removeChild(this.children[t].container),this.children[t].container.destroy({children:!0}),this.children[t]=null);const e=this.children;this.children=[];for(const t of e)null!==t&&this.children.push(t)}render(){for(const t of this.children)null!==t&&t.render()}destroy(){this.container.visible=!1,this.container.destroy(),this._alive=!1}}class p{get stage(){return this._stage}get api(){return this._api}constructor(t){this._api=t,this._stage=new r.Container,this.entities=new h(this.stage),t.root.addChild(this.stage)}add(t){this.entities.add(t)}update(){this.entities.update()}render(){this.entities.container.x=-this.api.jss.getViewXReal(),this.entities.container.y=-this.api.jss.getViewYReal(),this.entities.render()}kill(){this.stage.visible=!1,this.api.root.removeChild(this.stage),this.stage.destroy()}}class o{constructor(t){this._parent=t}get parent(){return this._parent}init(){}*update(){}render(){}*sleep(t,e){for(let s=0;s<t;s++)void 0!==e&&e(),yield}damage(t,e,s){t.setMyHPDamage(e),t.getMyHP()<=0&&t.setMyMiss(s)}}class l{get done(){return 0===this.state_stack.length||this.state_stack[this.state_stack.length-1].done}set done(t){0!==this.state_stack.length&&(this.state_stack[this.state_stack.length-1].done=t)}get loop(){return 0===this.state_stack.length||this.state_stack[this.state_stack.length-1].loop}get state_changed_in_update(){return 0!==this.state_stack.length&&this.state_stack[this.state_stack.length-1].state_changed_in_update}set state_changed_in_update(t){0!==this.state_stack.length&&(this.state_stack[this.state_stack.length-1].state_changed_in_update=t)}get state(){return 0===this.state_stack.length?null:this.state_stack[this.state_stack.length-1].state}get generator(){return 0===this.state_stack.length?null:this.state_stack[this.state_stack.length-1].generator}constructor(){this.state_stack=[]}regenerate(){const t=this.state_stack.length;0!==t&&(this.done=!1,this.state_stack[t-1].generator=this.state_stack[t-1].state.update())}setState(t,e=!0){this.state_stack.length=0,this.pushState(t,e)}pushState(t,e=!0){this.state_stack.push({state:t,loop:e,done:!1,state_changed_in_update:!0,generator:t.update()}),this.state.init()}popState(){this.state_stack.length>0&&(this.state_stack.length-=1),this.state_changed_in_update=!0}update(){if(this.state_changed_in_update=!1,null!==this.state&&null!==this.generator&&this.generator.next().done&&!1===this.state_changed_in_update)for(this.done=!0;this.state_stack.length>0&&this.done;)this.loop?this.regenerate():this.state_stack.length-=1}render(){null!==this.state&&this.state.render()}}class c extends l{get container(){return this._container}get alive(){return this._alive}get api(){return this.level.api}get x(){return this.container.x}set x(t){this.container.x=t}get y(){return this.container.y}set y(t){this.container.y=t}get level(){return this._level}get ee(){return this._ee}constructor(t,e,s){super(),this._level=t,this._alive=!0,this._container=new r.Container,this._container.x=e,this._container.y=s,this._ee=new r.utils.EventEmitter}kill(){this._alive=!1}update(){this.done&&this.alive?this.kill():super.update()}}class d{get pattern(){return this._pattern}get images(){return this._images}get textures(){return this._textures}get sounds(){return this._sounds}constructor(t){this._pattern=[],this._pattern.length=250;for(let e=0;e<250;e++)this._pattern[e]=t.pattern.textures[`pattern_${e}`];this._images={},this._sounds={};for(const[e,s]of Object.entries(t)){const t=/^(.*)_image$/.exec(e);if(null!==t){this._images[t[1]]=s.texture;continue}const i=/^(.*)_sound$/.exec(e);null!==i&&(this._sounds[i[1]]=s.data)}this._textures=new Map}play(t,e=!0){e&&(this.sounds[t].pause(),this.sounds[t].currentTime=0),this.sounds[t].play().then(()=>null).catch(t=>{throw t})}registerIfNecessary(t,e){return this.textures.has(t)||this.textures.set(t,e()),this.textures.get(t)}static createResizeTexture(t,e,s,i=0,a=0){const n=t.clone(),r=n.frame.clone();return r.x+=i,r.y+=a,r.width=e,r.height=s,n.frame=r,n}}var u=s(1),m=s.n(u);const f=m()(.19,1,.22,1),g=m()(.215,.61,.355,1),_=m()(.645,.045,.355,1),y=m()(.47,0,.745,.715);class x extends c{constructor(t,e){super(t,t.api.jss.getMyYReal(),t.api.jss.getMyYReal()),this.max_hp=e;const{jss:s,resource:i}=this.api;this.current_hp=e,this.health_rate=1,this.frame=new r.Sprite(i.images.health_bar),this.frame.position.x=this.frame.position.y=24,this.container.addChild(this.frame),this.x=s.getViewXReal(),this.y=s.getViewYReal(),this.bar=r.Sprite.from((()=>{const t=document.createElement("canvas");t.width=1,t.height=12;const e=t.getContext("2d"),s=e.createLinearGradient(0,0,0,12);return s.addColorStop(0,"#00dd00"),s.addColorStop(.65,"#00aa00"),s.addColorStop(.9,"#00dd00"),e.fillStyle=s,e.fillRect(0,0,1,12),t})()),this.bar.scale.x=128,this.bar.position.x=this.bar.position.y=3,this.frame.addChild(this.bar),this.colormatrix=new r.filters.ColorMatrixFilter,this.bar.filters=[this.colormatrix];const a=i.textures,n=t=>`health_bar_face_${t}`;for(const[t,e]of[["normal",100],["damage",107],["miss",110]])i.registerIfNecessary(n(t),()=>d.createResizeTexture(i.pattern[e],32,16));this.textures={normal:a.get(n("normal")),damage:a.get(n("damage")),miss:a.get(n("miss"))},this.face=new r.Sprite,this.face.x=3,this.face.y=20,this.face.anchor.x=1,this.face.scale.x=-1,this.setFaceTexture("normal"),this.frame.addChild(this.face);const h=new r.TextStyle({dropShadow:!0,dropShadowAlpha:.2,dropShadowDistance:2,fill:["#cc8336","#45454f"],fontFamily:"monospace",fontSize:14,fontWeight:"bold",miterLimit:3,padding:3,stroke:"white",strokeThickness:2});this.text=new r.Text(`HP: ${Math.round(100*this.health_rate)} / 100`,h),this.text.x=41,this.text.y=23,this.frame.addChild(this.text);const p=s.createPlayerEventEmitter();p.on("damage",()=>{this.setFaceTexture("damage")}),p.on("muteki_end",()=>{this.setFaceTexture("normal")}),p.on("miss",()=>{this.setFaceTexture("miss"),s.removePlayerEventEmitter(p)}),this.setState(new v.Default(this))}setFaceTexture(t){this.face.texture=this.textures[t]}}var v,w,S,b,M,k,D,C,j,A,E,P,R,T,I;!function(t){class e extends o{init(){}render(){this.parent.x=this.parent.api.jss.getViewXReal(),this.parent.y=this.parent.api.jss.getViewYReal(),this.parent.bar.scale.x=128*this.parent.health_rate,this.parent.text.text=`HP: ${Math.round(100*this.parent.health_rate).toString().padStart(3)} / 100`}}class s extends e{*update(){if(this.parent.api.jss.getMyHP()<this.parent.current_hp){const t=this.parent.current_hp;this.parent.current_hp=this.parent.api.jss.getMyHP(),this.parent.setState(new i(this.parent,t,this.parent.current_hp,(t-this.parent.current_hp)/this.parent.max_hp*10+10))}else this.parent.api.jss.getMyHP()!==this.parent.current_hp&&(this.parent.current_hp=this.parent.api.jss.getMyHP());this.parent.colormatrix.hue(-120*(1-this.parent.health_rate))}}t.Default=s;class i extends e{constructor(t,e,s,i=10){super(t),this.hp_from=e,this.hp_to=s,this.max_frame=i,this.easing=f}*update(){const t=this.hp_from-this.hp_to;for(let e=0;e<this.max_frame;e++)this.parent.health_rate=(this.hp_from-t*this.easing(e/this.max_frame))/this.parent.max_hp,this.parent.colormatrix.hue(-120),yield;this.parent.health_rate=this.hp_to/this.parent.max_hp,this.parent.setState(new s(this.parent))}}t.DamageAnimation=i}(v||(v={}));class Y extends c{constructor(t,e,s,i){super(t,e,s),this.hp=i}damage(t){return this.hp-=t,this.hp<0&&(this.hp=0),this.hp>0}}class F extends c{constructor(t,e,s,i,a=32,n=20){super(t,0,0),this.to_x=e,this.to_y=s,this.timespan=n,this.x=e-a*Math.cos(i),this.y=s-a*Math.sin(i);const{resource:h}=this.api;this.sprite=new r.Sprite(h.images.bullet_blue),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.filters=[this.filter=new r.filters.ColorMatrixFilter,new r.filters.AlphaFilter],this.sprite.filters[1].blendMode=r.BLEND_MODES.ADD;const p=.25*Math.random();this.sprite.scale.x=.25+p,this.sprite.scale.y=.25+p,this.sprite.alpha=.1,this.container.addChild(this.sprite),this.setState(new w.Default(this),!1)}}!function(t){(w||(w={})).Default=class extends o{init(){this.skip=0,this.parent.filter.hue(this.skip)}*update(){const t=this.parent.to_x-this.parent.x,e=this.parent.to_y-this.parent.y,s=g;for(let i=0;i<this.parent.timespan;i++)this.parent.x=this.parent.to_x-t*(1-s(i/this.parent.timespan)),this.parent.y=this.parent.to_y-e*(1-s(i/this.parent.timespan)),yield}render(){}}}();class z extends c{constructor(t,e,s,i=Math.PI,a=16){super(t,e,s),this.rad=i,this.speed=a,this.vx=a*Math.cos(i),this.vy=a*Math.sin(i);const{resource:n}=this.api,h=new r.Sprite(n.images.bullet_blue);h.anchor.x=.5,h.anchor.y=.5,h.filters=[this.filter=new r.filters.ColorMatrixFilter,new r.filters.AlphaFilter],h.filters[1].blendMode=r.BLEND_MODES.ADD,this.container.addChild(h),this.setState(new S.Default(this))}}!function(t){(S||(S={})).Default=class extends o{init(){this.phase=0,this.parent.filter.hue(this.phase)}*update(){this.phase=(this.phase+12)%360,this.parent.x+=this.parent.vx,this.parent.y+=this.parent.vy;const{jss:t}=this.parent.api,e=this.parent.x,s=this.parent.y,i=e-(t.getMyXReal()+16),a=s-(t.getMyYReal()+16);i*i+a*a<400&&this.damage(t,15,1);const n=t.getViewXReal(),r=t.getViewYReal();(e+32<n||e-32>n+Dt||s+32<r||s-32>r+Ct)&&this.parent.kill(),this.parent.filter.hue(20*(Math.cos(this.phase*Math.PI/180)-1))}render(){}}}();class L extends c{constructor(t,e,s,i,a=0,n=32,h=32,p=64,o=64,l=10){super(t,s,i),this.rad=a,this.width=n,this.height=h,this.width_end=p,this.height_end=o,this.timespan=l,this.sprite=e,this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.scale.x=n/64,this.sprite.scale.y=h/64,this.sprite.rotation=a,this.sprite.blendMode=r.BLEND_MODES.ADD,this.container.addChild(this.sprite),this.setState(new b.Default(this),!1)}}!function(t){(b||(b={})).Default=class extends o{init(){}*update(){const t=f;for(let e=0;e<=this.parent.timespan;e++)this.parent.sprite.scale.x=this.parent.width/64+(this.parent.width_end-this.parent.width)/64*t(e/this.parent.timespan),this.parent.sprite.scale.y=this.parent.height/64+(this.parent.height_end-this.parent.height)/64*t(e/this.parent.timespan),this.parent.sprite.alpha=1-t(e/this.parent.timespan),yield}render(){}}}();class N extends L{constructor(t,e,s,i=0,a=32,n=32,h=64,p=64,o=10){super(t,new r.Sprite(t.api.resource.images.shockwave_asymmetry),e,s,i,a,n,h,p,o)}}class O extends c{constructor(t,e,s,i=!1){super(t,e,s),this.strong=i,this.entities=new h(this.container),this.sprite_body=new r.Sprite(t.api.resource.images.bullet_blue),this.sprite_body.anchor.x=.5,this.sprite_body.anchor.y=.5,this.sprite_body.alpha=0,this.sprite_body.scale.x=this.sprite_body.scale.y=0,this.container.addChild(this.sprite_body),this.setState(new M.Default(this),!1)}}!function(t){(M||(M={})).Default=class extends o{init(){}*update(){const t=this.charge(),e=f;for(;this.parent.sprite_body.alpha<1;)t.next(),this.parent.entities.update(),this.parent.sprite_body.alpha+=.04,this.parent.sprite_body.scale.x=this.parent.sprite_body.scale.y=1.6*this.parent.sprite_body.alpha,yield;this.parent.entities.destroy(),this.parent.sprite_body.alpha=1,this.parent.sprite_body.scale.x=this.parent.sprite_body.scale.y=1.6;for(let t=1.6;t>=1;t-=.3){this.parent.api.resource.play("mgan");for(let t=0;t<3;t++){const e=Math.atan2(this.parent.api.jss.getMyYReal()+16-this.parent.y,this.parent.api.jss.getMyXReal()+16-this.parent.x);this.attack(e),this.parent.strong&&(0===t?(this.attack(e-Math.PI/24),this.attack(e+Math.PI/24)):2===t&&(this.attack(e-Math.PI/12),this.attack(e+Math.PI/12))),yield}if(this.parent.sprite_body.scale.x=this.parent.sprite_body.scale.y=t,1===t)break;for(let s=0;s<8;s++)this.parent.sprite_body.scale.x=this.parent.sprite_body.scale.y=t-.3*e(s/8),yield;yield*this.sleep(2),this.parent.strong&&(yield*this.sleep(2))}this.parent.sprite_body.blendMode=r.BLEND_MODES.ADD;for(let t=0;t<8;t++)this.parent.sprite_body.alpha=1-t/8,this.parent.sprite_body.scale.x=this.parent.sprite_body.scale.y=1-e(t/8),yield}attack(t=Math.PI){this.parent.level.add(new z(this.parent.level,this.parent.x,this.parent.y,t)),this.parent.level.add(new N(this.parent.level,this.parent.x-8,this.parent.y,Math.PI,16,32,48,96))}*charge(){for(let t=0;t<6;t++){for(let t=0;t<30;t++){const t=8*Math.random(),e=2*Math.random()*Math.PI;this.parent.entities.add(new F(this.parent.level,t*Math.cos(e),t*Math.sin(e),2*Math.random()*Math.PI,32+32*Math.random(),20+20*Math.random()))}yield}}render(){this.parent.entities.alive&&this.parent.entities.render()}}}();class J extends c{get on(){return this._on}constructor(t,e,s){super(t,e,s),this._on=!0,this.showing=!1;const{resource:i}=this.api;this.sprite=new r.Sprite(i.images.shield),this.sprite.filters=[this.alpha_filter=new r.filters.AlphaFilter(0)],this.sprite.anchor.x=this.sprite.anchor.y=.5,this.sprite.scale.x=this.sprite.scale.y=1.2,this.container.addChild(this.sprite),this.show()}show(){this.on&&this.showing||this.setState(new k.Showing(this))}hide(){this.setState(new k.Hide(this))}}!function(t){class e extends o{init(){this.parent.showing=!1}}t.Default=e;t.Hide=class extends o{init(){this.parent._on=!1,this.parent.showing=!1,this.parent.container.visible=!1}};t.Showing=class extends o{*update(){this.parent.api.resource.play("shield"),this.parent._on=!0,this.parent.showing=!0,this.parent.container.visible=!0;const t=new r.Sprite(this.parent.level.api.resource.registerIfNecessary("shield_mask",()=>{const t=document.createElement("canvas");t.width=100,t.height=180;const e=t.getContext("2d"),s=e.createLinearGradient(0,0,0,180);return s.addColorStop(.6,"#ffffffff"),s.addColorStop(.8,"#ffffff00"),e.fillStyle=s,e.fillRect(0,0,100,180),r.Texture.fromCanvas(t)}));t.anchor.set(.5,1),this.parent.container.addChild(t),this.parent.container.mask=t,t.y=10;const s=new r.Sprite(this.parent.level.api.resource.images.shockwave_asymmetry);s.anchor.set(.5,.5),s.scale.set(.8,1.6),s.y=-72,s.rotation=-Math.PI/2,this.parent.container.addChild(s),this.parent.alpha_filter.alpha=.8;const i=_;for(let e=0;e<20;e++)14===e&&(this.parent.showing=!1),s.alpha=e<6?0:1,t.y=10+120*i(e/20),s.y=120*i(e/20)-72,s.scale.x=.8*Math.sin(i(e/20)*Math.PI),s.scale.y=1.6*Math.sin(i(e/20)*Math.PI),this.parent.alpha_filter.alpha=.8+.2*Math.sin(i(e/20)*Math.PI),yield;this.parent.container.removeChild(s),this.parent.container.removeChild(t),this.parent.container.mask=null,this.parent.setState(new e(this.parent))}}}(k||(k={}));class X extends c{constructor(t,e,s,i,a){super(t,e,s),this.vx=a*Math.cos(i),this.vy=a*Math.sin(i);const{resource:n}=this.api;this.sprite=new r.Sprite(n.images.shield),this.sprite.filters=[this.alpha_filter=new r.filters.AlphaFilter],this.sprite.anchor.x=this.sprite.anchor.y=.5,this.sprite.scale.x=this.sprite.scale.y=1.2,this.alpha_filter.blendMode=r.BLEND_MODES.ADD,this.container.addChild(this.sprite),this.setState(new D.Default(this))}}!function(t){(D||(D={})).Default=class extends o{*update(){this.parent.x+=this.parent.vx,this.parent.y+=this.parent.vy;const{jss:t}=this.parent.api,e=this.parent.x,s=this.parent.y,i=e-(t.getMyXReal()+16),a=s-(t.getMyYReal()+16);i*i+a*a<2304&&this.damage(t,25,1);const n=t.getViewXReal(),r=t.getViewYReal();(e+96<n||e>96+n+Dt||s+96<r||s>96+r+Ct)&&this.parent.kill()}render(){}}}();class V extends L{constructor(t,e,s,i=0,a=32,n=32,h=64,p=64,o=10){super(t,new r.Sprite(t.api.resource.images.shockwave),e,s,i,a,n,h,p,o)}}class B extends c{constructor(t,e,s){super(t,e,s),this.vx=-4,this.vy=0;const{resource:i}=this.api;this.points=[[0,0],[12,0],[20,0],[32,0]].map(([t,e])=>new r.Point(t,e)),this.body=new r.mesh.Rope(i.images.long_bullet,this.points),this.body.filters=[this.filter=new r.filters.ColorMatrixFilter,new r.filters.AlphaFilter],this.body.filters[1].blendMode=r.BLEND_MODES.ADD,this.body.scale.set(2,3),this.container.addChild(this.body),this.setState(new C.Expand(this))}end(){this.setState(new C.End(this),!1)}}!function(t){class e extends o{*update(){const t=this.move();for(;;){const{done:e}=t.next();if(this.checkCollision(),e)break;yield}}checkCollision(){const{jss:t}=this.parent.api,e=this.parent.body.scale,s=this.parent.x+this.parent.points[1].x*e.x,i=this.parent.y-16,a=(this.parent.points[2].x-this.parent.points[1].x)*e.x,n=32/3*e.y,r=t.getMyXReal(),h=t.getMyYReal();r<=s+a&&r+32>=s&&h<i+n&&h+32>=i&&this.damage(t,20,1)}}class s extends e{*move(){}}t.Default=s;t.Expand=class extends e{init(){this.timespan=20}*move(){for(let t=0;t<this.timespan;t++)this.parent.points[0].x-=32,this.parent.points[1].x-=32,yield;this.parent.setState(new s(this.parent))}};t.End=class extends o{init(){this.timespan=14}*update(){const t=f,e=this.parent.body.scale.y;for(let s=0;s<this.timespan;s++)this.parent.body.scale.y=e*(1-t(s/this.timespan)),yield}}}(C||(C={}));class G extends c{constructor(t,e,s,i,a=1){super(t,e,s),this.rotate_direction=a,this.vx=-4,this.vy=0;const{resource:n}=this.api;this.sprite=new r.Sprite(n.images.ring),this.sprite.filters=[this.filter=new r.filters.ColorMatrixFilter,new r.filters.AlphaFilter(.9)],this.sprite.filters[1].blendMode=r.BLEND_MODES.ADD,this.sprite.anchor.set(.5),this.sprite.scale.set(0),this.degree=i,this.container.addChild(this.sprite),this.setState(new j.Showing(this))}get degree(){return this._degree}set degree(t){(t%=360)<0&&(t+=360),this._degree=t,this.sprite.rotation=this._degree/180*Math.PI}hide(){this.setState(new j.Hide(this),!1)}}!function(t){class e extends o{*update(){const t=this.move();for(;;){const{done:e}=t.next();if(this.checkCollision(),e)break;yield}}*move(){for(let t=0;t<360;t++)this.parent.degree=this.parent.degree+this.parent.rotate_direction,359!==t&&(yield)}checkCollision(){const{jss:t}=this.parent.api,e=t.getMyXReal()+16,s=t.getMyYReal()+16,i=this.parent.degree*Math.PI/180,a=e-(this.parent.x+64*Math.cos(i)),n=s-(this.parent.y+64*Math.sin(i)),r=e-(this.parent.x+64*Math.cos(i+Math.PI)),h=s-(this.parent.y+64*Math.sin(i+Math.PI));(a*a+n*n<400||r*r+h*h<400)&&this.damage(t,10,1)}}t.Default=e;t.Showing=class extends o{*update(){const t=_;for(let e=0;e<20;e++)this.parent.sprite.scale.set(3*t(e/20),t(e/20)),yield;this.parent.sprite.scale.set(3,1);const s=this.parent.degree;for(let e=0;e<40;e++){this.parent.degree=s+720*t(e/40)*this.parent.rotate_direction;let i=t(e/40)-.5;i<0&&(i*=-1),i=.2+.8*(i*=2),this.parent.sprite.scale.set(3*i,i),20===e&&this.parent.ee.emit("shrink"),yield}this.parent.sprite.scale.set(3,1),this.parent.degree=s,this.parent.setState(new e(this.parent))}};t.Hide=class extends o{*update(){const t=_;for(let e=0;e<20;e++)this.parent.degree+=this.parent.rotate_direction,this.parent.sprite.scale.set(3*(1-t(e/20)),1-t(e/20)),this.parent.sprite.alpha=1-t(e/20),yield;this.parent.sprite.scale.set(0,0),this.parent.kill()}}}(j||(j={}));class H extends c{constructor(t,e,s,i=0,a=1){super(t,e,s),this.degree_offset=i,this.scale=a;const{resource:n}=this.api;this.sprite=new r.Sprite(n.images.ring),this.sprite.filters=[this.filter=new r.filters.ColorMatrixFilter,new r.filters.AlphaFilter(.9)],this.sprite.filters[1].blendMode=r.BLEND_MODES.ADD,this.sprite.anchor.set(.5),this.sprite.scale.set(0),this.container.addChild(this.sprite),this.setState(new A.Default(this))}}!function(t){(A||(A={})).Default=class extends o{*update(){const t=this.move();for(;;){const{done:e}=t.next();if(this.checkCollision(),e)break;yield}}*move(){for(let t=0;t<360;t+=6){this.parent.x-=5;const e=(t+this.parent.degree_offset)/180*Math.PI,s=Math.abs(Math.sin(e));this.parent.sprite.scale.set(s*this.parent.scale,2*s*this.parent.scale),354!==t&&(yield)}}checkCollision(){const{jss:t}=this.parent.api,e=t.getMyXReal(),s=t.getMyYReal(),i=64*this.parent.sprite.scale.x*.2,a=64*this.parent.sprite.scale.y*.8,n=this.parent.x,r=this.parent.y;e+8<=n+i/2&&e+24>=n-i/2&&s+8<r+a/2&&s+24>=r-a/2&&this.damage(t,13,1);const h=t.getViewXReal(),p=t.getViewYReal();(n+i+32<h||n-32>h+Dt||r+a+32<p||r-32>p+Ct)&&this.parent.kill()}}}();class $ extends c{constructor(t,e,s){super(t,t.api.jss.getMyYReal(),t.api.jss.getMyYReal()),this.parent=e,this.max_hp=s,this.current_hp=s,this.health_rate=1,this.bar=r.Sprite.from((()=>{const t=document.createElement("canvas");t.width=1,t.height=12;const e=t.getContext("2d"),s=e.createLinearGradient(0,0,0,8);return s.addColorStop(0,"#00dd00"),s.addColorStop(.65,"#00aa00"),s.addColorStop(.9,"#00dd00"),e.fillStyle=s,e.fillRect(0,0,1,8),t})()),this.bar.scale.x=128,this.bar.y=64,this.container.addChild(this.bar),this.colormatrix=new r.filters.ColorMatrixFilter,this.bar.filters=[this.colormatrix];const i=new r.TextStyle({dropShadow:!0,dropShadowAlpha:.2,dropShadowDistance:2,fill:["#aaaaaa","#333333"],fontFamily:"monospace",fontSize:10,fontWeight:"bold",miterLimit:3,padding:3,stroke:"white",strokeThickness:2});this.text=new r.Text(`${Math.round(100*this.health_rate)} / 100`,i),this.text.y=74,this.text.x=64-this.text.width,this.container.addChild(this.text),this.setState(new E.Default(this))}}!function(t){class e extends o{init(){}render(){this.parent.x=this.parent.parent.x,this.parent.y=this.parent.parent.y,this.parent.bar.scale.x=64*this.parent.health_rate,this.parent.text.text=`${Math.round(100*this.parent.health_rate).toString().padStart(3)} / 100`}}class s extends e{*update(){if(this.parent.parent.hp<this.parent.current_hp){const t=this.parent.current_hp;this.parent.current_hp=this.parent.parent.hp,this.parent.setState(new i(this.parent,t,this.parent.current_hp,(t-this.parent.current_hp)/this.parent.max_hp*10+10))}else this.parent.parent.hp!==this.parent.current_hp&&(this.parent.current_hp=this.parent.parent.hp);this.parent.colormatrix.hue(-120*(1-this.parent.health_rate))}}t.Default=s;class i extends e{constructor(t,e,s,i=10){super(t),this.hp_from=e,this.hp_to=s,this.max_frame=i,this.easing=f}*update(){const t=this.hp_from-this.hp_to;for(let e=0;e<this.max_frame;e++)this.parent.health_rate=(this.hp_from-t*this.easing(e/this.max_frame))/this.parent.max_hp,this.parent.colormatrix.hue(-120*(1-this.parent.health_rate)),yield;this.parent.health_rate=this.hp_to/this.parent.max_hp,this.parent.colormatrix.hue(-120*(1-this.parent.health_rate)),this.parent.setState(new s(this.parent))}}t.DamageAnimation=i}(E||(E={}));class W extends c{constructor(t,e,s,i,a=0){super(t,e,s);const n=(()=>{switch(a){case 1:return new r.TextStyle({fill:["#00ffff","#00cccc"],fontFamily:"monospace",fontSize:16,fontWeight:"bold",padding:3,strokeThickness:0});case 0:default:return new r.TextStyle({fill:["#ff0000","#ff3333"],fontFamily:"monospace",fontSize:16,fontWeight:"bold",padding:3,stroke:"red",strokeThickness:0})}})();this.text=new r.Text(`${i}`,n),this.text.anchor.x=.5,this.text.anchor.y=.5,this.container.addChild(this.text),this.setState(new P.Default(this),!1)}}!function(t){(P||(P={})).Default=class extends o{init(){}*update(){const t=4*(Math.random()-.5);let e=-14-8*Math.random();for(;e<10;)this.parent.x+=t,this.parent.y+=e,e+=4,this.parent.text.style.fontSize+=1,yield;for(let e=0;e<3;e++)this.parent.x+=t,yield}render(){}}}();class q extends c{constructor(t,e,s){super(t,e,s),this.textures=[],this.textures.push(t.api.resource.registerIfNecessary("target_moving",()=>{const t=document.createElement("canvas");t.width=t.height=32;const e=t.getContext("2d");return e.strokeStyle="#00ff00",e.lineWidth=2,e.beginPath(),e.moveTo(16,1),e.lineTo(1,16),e.lineTo(16,31),e.lineTo(31,16),e.closePath(),e.stroke(),r.Texture.from(t)})),this.textures.push(t.api.resource.registerIfNecessary("target_locked",()=>{const t=document.createElement("canvas");t.width=t.height=32;const e=t.getContext("2d");return e.strokeStyle="#ff0000",e.lineWidth=2,e.beginPath(),e.moveTo(16,1),e.lineTo(1,16),e.lineTo(16,31),e.lineTo(31,16),e.closePath(),e.stroke(),r.Texture.from(t)})),this.sprite=new r.Sprite(this.textures[0]),this.sprite.anchor.set(.5),this.container.addChild(this.sprite),this.sprite2=new r.Sprite(this.textures[0]),this.sprite2.anchor.set(.5),this.sprite2.scale.set(2),this.container.addChild(this.sprite2),this.setState(new R.Default(this),!1)}}!function(t){(R||(R={})).Default=class extends o{init(){}*update(){const t=this.parent.x,{jss:e}=this.parent.api,s=g,i=2-Math.sqrt(2);for(let a=0;a<40;a++){const n=e.getMyXReal()+16,r=e.getMyYReal()+16,h=-1!==e.getMyXReal()?n-this.parent.x:0,p=-1!==e.getMyYReal()?r-this.parent.y:0,o=h*h+p*p,l=12+Math.floor(a/5);if(o>l*l){const t=Math.sqrt(o);this.parent.x+=h*l/t,this.parent.y+=p*l/t}else this.parent.x+=h,this.parent.y+=p;this.parent.y=Math.max(this.parent.y,e.getViewYReal()+80),this.parent.y=Math.min(this.parent.y,e.getViewYReal()+Ct-48-2),this.parent.x=Math.min(this.parent.x,t),this.parent.sprite2.scale.set(2-i*s(a/40)),this.parent.sprite2.rotation=a/40*Math.PI/4,yield}this.parent.sprite2.scale.set(Math.sqrt(2)),this.parent.sprite2.rotation=Math.PI/4,this.parent.sprite.texture=this.parent.textures[1],this.parent.sprite2.texture=this.parent.textures[1],this.parent.container.x+=1,this.parent.container.y-=1,this.parent.ee.emit("locked"),yield*this.sleep(65)}render(){}}}();class Q extends c{constructor(t,e,s){super(t,e,s);const{resource:i}=this.api;this.sprite=new r.Sprite(i.images.bullet_blue),this.sprite.scale.set(.5+.25*Math.random()),this.sprite.anchor.set(.5),this.sprite.alpha=.15,this.sprite.blendMode=r.BLEND_MODES.ADD,this.container.addChild(this.sprite),this.setState(new T.Default(this),!1)}}!function(t){(T||(T={})).Default=class extends o{init(){this.r=24+32*Math.random(),this.cx=this.parent.x,this.cy=this.parent.y}*update(){let t=0,e=360*Math.random(),s=8+16*Math.random(),i=this.r;for(;t<=18;){const a=e*Math.PI/180;this.parent.x=this.cx+i*Math.cos(a),this.parent.y=this.cy+i*Math.sin(a),e=(e+s)%360,i=this.r*(1-y(t/18)),this.parent.sprite.alpha=.15*y(t/18),t++,yield}}}}();class U extends c{constructor(t,e,s){super(t,e,s),this.entities=new h(this.container),this.setState(new I.Default(this),!1)}}!function(t){(I||(I={})).Default=class extends o{constructor(t,e=60){super(t),this.timespan=e}init(){}*update(){for(let t=0;t<this.timespan;t++){for(let t=0;t<12;t++)this.parent.entities.add(new Q(this.parent.level,0,0));this.parent.entities.update(),yield}for(;this.parent.entities.size>0;)this.parent.entities.update(),yield}render(){this.parent.entities.render()}}}();const K=(t,e,s)=>i=>({x:(1-i)*(1-i)*t.x+2*(1-i)*i*e.x+i*i*s.x,y:(1-i)*(1-i)*t.y+2*(1-i)*i*e.y+i*i*s.y});class Z extends c{constructor(t,e,s,i,a,n,h,p=0){super(t,e,s),this.tx=i,this.ty=a,this.mx=n,this.my=h,this.dt=p;const{resource:o}=this.api;this.sprite=new r.Sprite(o.images.bullet_blue),this.sprite.scale.set(.5+.25*Math.random()),this.sprite.anchor.set(.5),this.sprite.alpha=.1,this.sprite.blendMode=r.BLEND_MODES.SCREEN,this.container.addChild(this.sprite),this.setState(new tt.Default(this),!1)}}var tt,et,st,it,at;!function(t){(tt||(tt={})).Default=class extends o{*update(){const t=K(this.parent,{x:this.parent.mx,y:this.parent.my},{x:this.parent.tx,y:this.parent.ty});for(let e=0;e<35;e++){const s=(e+this.parent.dt)/35+.3*(Math.random()-.5)/35;this.parent.x=t(s).x,this.parent.y=t(s).y,yield}this.parent.x=this.parent.tx,this.parent.y=this.parent.ty,yield*this.sleep(10)}}}();class nt extends c{constructor(t,e,s,i,a,n=-1){super(t,e,s),this.tx=i,this.ty=a,this.my=n,this.entities=new h(this.container),this.setState(new et.Default(this),!1)}}!function(t){(et||(et={})).Default=class extends o{constructor(t,e=60){super(t),this.timespan=e}init(){}*update(){const t=this.parent.api.jss.getViewXReal()+Dt,e=this.parent.my>=0?this.parent.api.jss.getViewYReal()+this.parent.my:this.parent.api.jss.getViewYReal()+Ct*Math.random();for(let s=0;s<this.timespan;s++){for(let s=0;s<5;s++)this.parent.entities.add(new Z(this.parent.level,0,0,this.parent.tx-this.parent.x,this.parent.ty-this.parent.y,t-this.parent.x,e-this.parent.y,s/8));this.parent.entities.update(),yield}for(;this.parent.entities.size>0;)this.parent.entities.update(),yield}render(){this.parent.entities.render()}}}();class rt extends c{constructor(t,e,s,i=1){super(t,e,s),this.scale=i;const{resource:a}=this.api;this.sprite=new r.Sprite(a.images.bullet_blue),this.sprite.scale.set(0),this.sprite.anchor.set(.5),this.sprite.alpha=.15,this.sprite.blendMode=r.BLEND_MODES.ADD,this.container.addChild(this.sprite),this.cx=this.x,this.cy=this.y,this.degree=360*Math.random(),this.r=24+32*Math.random(),this.vd=8+16*Math.random(),this.setState(new st.Default(this),!1)}shrink(){this.setState(new st.Shrink(this),!1)}}!function(t){t.Default=class extends o{*update(){const t=this.parent.r;this.parent.r=0;const e=.5+.25*Math.random();for(let s=0;s<18;s++){const i=y(s/18),a=this.parent.degree*Math.PI/180;this.parent.x=this.parent.cx+this.parent.r*Math.cos(a),this.parent.y=this.parent.cy+this.parent.r*Math.sin(a),this.parent.degree=(this.parent.degree+this.parent.vd)%360,this.parent.r=t*i,this.parent.sprite.alpha=.15*(1-i),this.parent.sprite.scale.set((e+i)*this.parent.scale),yield}}};t.Shrink=class extends o{*update(){const t=this.parent.r,e=this.parent.sprite.scale.x;for(let s=0;s<18;s++){const i=y(s/18),a=this.parent.degree*Math.PI/180;this.parent.x=this.parent.cx+this.parent.r*Math.cos(a),this.parent.y=this.parent.cy+this.parent.r*Math.sin(a),this.parent.degree=(this.parent.degree+this.parent.vd)%360,this.parent.r=t*(1-i),this.parent.sprite.scale.set(e*(.05+.95*(1-i))),yield}yield*this.sleep(10)}}}(st||(st={}));class ht extends c{constructor(t,e,s){super(t,e,s),this.entities=new h(this.container),this.setState(new it.Default(this),!1)}}!function(t){(it||(it={})).Default=class extends o{constructor(t,e=60){super(t),this.timespan=e}init(){}*update(){for(let t=0;t<this.timespan;t++){for(let e=0;e<12;e++){const e=new rt(this.parent.level,0,0,1+t/30);this.parent.ee.once("shrink",()=>e.shrink()),this.parent.entities.add(e)}this.parent.entities.update(),yield}for(this.parent.ee.emit("shrink");this.parent.entities.size>0;)this.parent.entities.update(),yield}render(){this.parent.entities.render()}}}();class pt extends c{constructor(t,e,s,i=!1){super(t,e,s),this.lock=i;const{resource:a}=this.api;this.sprite=new r.Sprite(a.images.bullet_blue_large),this.sprite.scale.set(0),this.sprite.anchor.set(.5),this.sprite.blendMode=r.BLEND_MODES.ADD,i&&(this.sprite.visible=!1),this.container.addChild(this.sprite),this.setState(new at.Default(this),!1)}unlock(){this.lock=!1}}!function(t){(at||(at={})).Default=class extends o{*update(){for(;this.parent.lock;)yield;this.parent.sprite.visible=!0;for(let t=0;t<20;t++)this.parent.sprite.scale.set(8*f(t/20)),this.checkCollision(),yield;for(let t=0;t<=20;t++)this.parent.sprite.alpha=1-f(t/20),yield}checkCollision(){const{jss:t}=this.parent.api,e=24*this.parent.sprite.scale.x,s=t.getMyXReal()+16,i=t.getMyYReal()+16,a=this.parent.x-s,n=this.parent.y-i;a*a+n*n<e*e&&this.damage(t,35,1)}}}();
/*!
 * @pixi/filter-glow - v2.5.0
 * Compiled Wed, 10 Jan 2018 17:38:59 UTC
 *
 * @pixi/filter-glow is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var ot,lt,ct,dt,ut,mt="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",ft="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform float distance;\nuniform float outerStrength;\nuniform float innerStrength;\nuniform vec4 glowColor;\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nconst float PI = 3.14159265358979323846264;\n\nvoid main(void) {\n    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\n    vec4 ownColor = texture2D(uSampler, vTextureCoord);\n    vec4 curColor;\n    float totalAlpha = 0.0;\n    float maxTotalAlpha = 0.0;\n    float cosAngle;\n    float sinAngle;\n    vec2 displaced;\n    for (float angle = 0.0; angle <= PI * 2.0; angle += %QUALITY_DIST%) {\n       cosAngle = cos(angle);\n       sinAngle = sin(angle);\n       for (float curDistance = 1.0; curDistance <= %DIST%; curDistance++) {\n           displaced.x = vTextureCoord.x + cosAngle * curDistance * px.x;\n           displaced.y = vTextureCoord.y + sinAngle * curDistance * px.y;\n           curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\n           totalAlpha += (distance - curDistance) * curColor.a;\n           maxTotalAlpha += (distance - curDistance);\n       }\n    }\n    maxTotalAlpha = max(maxTotalAlpha, 0.0001);\n\n    ownColor.a = max(ownColor.a, 0.0001);\n    ownColor.rgb = ownColor.rgb / ownColor.a;\n    float outerGlowAlpha = (totalAlpha / maxTotalAlpha)  * outerStrength * (1. - ownColor.a);\n    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * innerStrength * ownColor.a;\n    float resultAlpha = (ownColor.a + outerGlowAlpha);\n    gl_FragColor = vec4(mix(mix(ownColor.rgb, glowColor.rgb, innerGlowAlpha / ownColor.a), glowColor.rgb, outerGlowAlpha / resultAlpha) * resultAlpha, resultAlpha);\n}\n",gt=function(t){function e(e,s,i,a,n){void 0===e&&(e=10),void 0===s&&(s=4),void 0===i&&(i=0),void 0===a&&(a=16777215),void 0===n&&(n=.1),t.call(this,mt,ft.replace(/%QUALITY_DIST%/gi,""+(1/n/e).toFixed(7)).replace(/%DIST%/gi,""+e.toFixed(7))),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.distance=e,this.color=a,this.outerStrength=s,this.innerStrength=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var s={color:{configurable:!0},distance:{configurable:!0},outerStrength:{configurable:!0},innerStrength:{configurable:!0}};return s.color.get=function(){return r.utils.rgb2hex(this.uniforms.glowColor)},s.color.set=function(t){r.utils.hex2rgb(t,this.uniforms.glowColor)},s.distance.get=function(){return this.uniforms.distance},s.distance.set=function(t){this.uniforms.distance=t},s.outerStrength.get=function(){return this.uniforms.outerStrength},s.outerStrength.set=function(t){this.uniforms.outerStrength=t},s.innerStrength.get=function(){return this.uniforms.innerStrength},s.innerStrength.set=function(t){this.uniforms.innerStrength=t},Object.defineProperties(e.prototype,s),e}(r.Filter);class _t extends c{get pattern(){return this.level.api.resource.pattern}constructor(t,e,s,i=1){super(t,e,s),this.vx=40*i,this.vy=0,this.sprite=new r.Sprite(this.pattern[171]),this.sprite.anchor.set(.5),this.sprite.filters=[new gt(4,4,0,13421772)],this.container.addChild(this.sprite),this.setState(new ot.Fall(this))}}!function(t){class e extends o{checkCollision(){const{jss:t}=this.parent.api,e=t.getMyXReal(),s=t.getMyYReal(),i=e+16-this.parent.x,a=s+16-this.parent.y;i*i+a*a<576&&this.damage(t,12,1)}}t.Base=e;t.Fall=class extends e{*update(){this.parent.vx>0?this.parent.vx-=2:this.parent.vx<0&&(this.parent.vx+=2),this.parent.x+=Math.trunc(this.parent.vx/10),this.parent.vy+=8,this.parent.vy>200&&(this.parent.vy=200),this.parent.y+=Math.trunc(this.parent.vy/10),this.parent.api.jss.getMapchip(Math.floor((this.parent.x-32)/32),Math.floor((this.parent.y-320)/32))>=20&&(this.parent.y-=this.parent.y%32,this.parent.setState(new s(this.parent),!1)),this.checkCollision()}render(){const t=this.parent.pattern;this.parent.vx>28?(this.parent.sprite.texture=t[171],this.parent.sprite.scale.x=-1):this.parent.vx<-28?(this.parent.sprite.texture=t[171],this.parent.sprite.scale.x=1):(this.parent.sprite.texture=t[170],this.parent.sprite.scale.x=1)}};class s extends e{*update(){this.parent.api.resource.play("shot");const t=this.parent.pattern;this.parent.sprite.scale.x=1,this.parent.sprite.filters[0].enabled=!1;for(let e=1;e<=9;e++)this.parent.sprite.texture=e<=3?t[172]:e<=6?t[173]:t[174],this.checkCollision(),yield}}t.Explode=s}(ot||(ot={}));class yt extends Y{constructor(t,e,s){super(t,e,s,100);const{resource:i}=this.api;this.sprite_normal=new r.Sprite(i.registerIfNecessary("boss1_normal",()=>d.createResizeTexture(i.pattern[188],64,64))),this.sprite_damage=new r.Sprite(i.registerIfNecessary("boss1_damage",()=>d.createResizeTexture(i.pattern[178],64,32))),this.sprite_damage.y=32,this.sprite_damage.visible=!1,this.shield=new J(t,32,32),this.container.addChild(this.shield.container,this.sprite_normal,this.sprite_damage),this.healthbar=new $(t,this,this.hp),t.add(this.healthbar),this.setState(new lt.Normal1(this))}}!function(t){class e extends o{init(){this.parent.sprite_normal.visible=!0,this.parent.sprite_damage.visible=!1}*update(){for(const t of this.move())this.checkCollision(),this.parent.shield.update(),yield}checkCollision(){const{jss:t}=this.parent.api,e=t.getMyXReal(),s=t.getMyYReal();if(!this.parent.shield.on&&t.getMyVY()>10)e<=this.parent.x+64&&e+32>=this.parent.x&&s<this.parent.y+64&&s+32>=this.parent.y&&(t.setMyPress(3),t.setMyYReal(this.parent.y+8),t.addScore(10),this.parent.damage(20),this.parent.level.add(new W(this.parent.level,this.parent.x+32,this.parent.y+32,20,1)),this.parent.pushState(new u(this.parent)));else{const i=e+16-(this.parent.x+32),a=s+16-(this.parent.y+32);i*i+a*a<2304&&(this.parent.shield.showing?this.damage(t,5,2):this.damage(t,10,2))}}}t.Normal1=class extends e{*move(){this.parent.shield.on||this.parent.shield.showing||this.parent.shield.show(),yield*this.sleep(24),this.parent.pushState(new a(this.parent)),yield*this.sleep(24),this.parent.pushState(new c(this.parent)),yield*this.sleep(24),this.parent.pushState(new a(this.parent)),yield*this.sleep(24),this.parent.pushState(new n(this.parent)),yield,this.parent.shield.on||this.parent.shield.showing||this.parent.shield.show()}};class s extends e{*move(){this.parent.shield.on||this.parent.shield.showing||this.parent.shield.show(),yield*this.sleep(24),this.parent.pushState(new l(this.parent)),yield*this.sleep(24),this.parent.pushState(new c(this.parent)),yield*this.sleep(24),this.parent.pushState(new n(this.parent)),yield,this.parent.shield.on||this.parent.shield.showing||this.parent.shield.show()}}t.Normal2=s;class i extends e{*move(){this.parent.shield.on||this.parent.shield.showing||this.parent.shield.show(),yield*this.sleep(24),this.parent.pushState(new a(this.parent,!0)),yield*this.sleep(24),this.parent.pushState(new p(this.parent)),yield*this.sleep(24),this.parent.pushState(new a(this.parent,!0)),yield*this.sleep(24),this.parent.hp<=20&&(this.parent.pushState(new d(this.parent)),yield*this.sleep(24)),this.parent.pushState(new n(this.parent)),yield,this.parent.shield.on||this.parent.shield.showing||this.parent.shield.show(),yield*this.sleep(24)}}t.Normal3=i;class a extends e{constructor(t,e=!1){super(t),this.strong=e}*move(){this.parent.level.add(new O(this.parent.level,this.parent.x-8,this.parent.y+32,this.strong)),yield*this.sleep(70),this.parent.popState()}}t.ChargeAttackState=a;class n extends e{*move(){const t=new r.Sprite(this.parent.api.resource.images.shield);t.anchor.set(.5),t.scale.set(1.2),t.position.set(32),t.alpha=0,this.parent.container.addChildAt(t,1);const e=new h(this.parent.container);let s=0;for(let i=0;i<3;i++){this.parent.api.resource.play("charge2"),e.add(new V(this.parent.level,32,32,0,160+4*i,160+4*i,64,64,32+2*i));for(let a=0;a<[12,8,12][i];a++)e.update(),t.alpha=Math.sin(2*s*Math.PI/180),s++,yield}this.parent.container.removeChild(t),this.parent.container.removeChild(e.container),t.destroy(),e.destroy();const{jss:i}=this.parent.api,a=i.getMyXReal()+16,n=i.getMyYReal()+16,p=Math.atan2(n-(this.parent.y+32),a-(this.parent.x+32));for(let t=8;t<32;t+=4)this.parent.level.add(new X(this.parent.level,this.parent.x+32,this.parent.y+32,p,t));this.parent.shield.hide(),this.parent.api.resource.play("tobasu");for(let t=0;t<80&&(e.update(),!this.parent.shield.on||this.parent.shield.showing);t++)yield;this.parent.popState()}}t.ShieldAttackState=n;class p extends e{*move(){const t=this.parent.x;for(let t=0;4*t<48;t++)this.parent.x+=4,yield;this.parent.x=t+48;const e=[new G(this.parent.level,this.parent.x+32,this.parent.y+32,15,1),new G(this.parent.level,this.parent.x+32,this.parent.y+32,45,1),new G(this.parent.level,this.parent.x+32,this.parent.y+32,75,1),new G(this.parent.level,this.parent.x+32,this.parent.y+32,45,-1),new G(this.parent.level,this.parent.x+32,this.parent.y+32,135,-1)];for(const t of e)this.parent.level.add(t);let s=!1;for(e[0].ee.once("shrink",()=>{s=!0}),yield*this.sleep(22),this.parent.api.resource.play("charge1");!s;)yield;const i=new B(this.parent.level,this.parent.x-48,this.parent.y+32);this.parent.level.add(i),this.parent.api.resource.play("laser");for(let t=0;t<4;t++)this.parent.level.add(new H(this.parent.level,this.parent.x+32-8,this.parent.y+32,102)),this.parent.level.add(new H(this.parent.level,this.parent.x+32+8,this.parent.y+32,78)),this.parent.api.resource.play("happa"),yield*this.sleep(30),this.parent.level.add(new H(this.parent.level,this.parent.x+32-8,this.parent.y+32,12)),this.parent.level.add(new H(this.parent.level,this.parent.x+32+8,this.parent.y+32,-12)),this.parent.api.resource.play("happa"),yield*this.sleep(30);yield*this.sleep(40);for(const t of e)t.hide();yield*this.sleep(20),i.end(),yield*this.sleep(24);for(let t=0;4*t<48;t++)this.parent.x-=4,yield;this.parent.x=t,this.parent.popState()}}t.LaserAttackState=p;class l extends e{constructor(t,e=!1){super(t),this.do_not_pop=e}*move(){const t=new q(this.parent.level,this.parent.x+32,this.parent.y+32);let e=!1;for(t.ee.once("locked",()=>{e=!0}),this.parent.level.add(t),this.parent.api.resource.play("shot");!e;)yield;this.parent.api.resource.play("item");const s=t.x,i=t.y,a=new pt(this.parent.level,s,i,!0);this.parent.level.add(a),yield*this.sleep(10),this.parent.level.add(new U(this.parent.level,this.parent.x-32,this.parent.y+32)),yield*this.sleep(20);for(let t=0;t<5;t++)this.parent.level.add(new nt(this.parent.level,this.parent.x-32,this.parent.y+32,s,i,80*t));yield*this.sleep(35),this.parent.api.resource.play("trace"),this.parent.level.add(new ht(this.parent.level,s,i)),yield*this.sleep(74),this.parent.api.resource.play("charge1");for(let t=0;t<3;t++)this.parent.level.add(new V(this.parent.level,s,i,0,400,400,0,0,24-t)),yield;yield*this.sleep(6),this.parent.api.resource.play("tobasu"),a.unlock(),yield*this.sleep(12),this.do_not_pop||this.parent.popState()}}t.LockOnAttackState=l;class c extends e{constructor(t,e=!1){super(t),this.do_not_pop=e}static shuffle(t,e){t<0&&(t=0),e<0&&(e=0),e>t&&(e=t);const s=[];for(let i=0;i<t;i++)s.push(i<e);for(let e=t-1;e>=0;e--){const t=Math.floor(Math.random()*e),i=s[e];s[e]=s[t],s[t]=i}return s}*move(){const{jss:t}=this.parent.api,e=this.parent.x,s=this.parent.y,i=t.getViewXReal(),a=t.getViewYReal();for(;this.parent.x<=i+Dt+32;)this.parent.x+=6,yield;this.parent.x=i+Dt+64,this.parent.y=a-32,yield;const n=c.shuffle(16,8);for(this.parent.api.resource.play("mgan");this.parent.x>=i-96;){const t=Math.floor((this.parent.x+32-i)/32);t>=0&&t<n.length&&n[t]&&this.parent.level.add(new _t(this.parent.level,this.parent.x+32+48,this.parent.y+32+16,-1)),this.parent.x-=32,yield}yield*this.sleep(18),this.parent.y=a-64;const r=c.shuffle(16,8);for(this.parent.api.resource.play("mgan");this.parent.x<=i+Dt+32;){const t=Math.floor((this.parent.x+32-i)/32);t>=0&&t<r.length&&r[t]&&this.parent.level.add(new _t(this.parent.level,this.parent.x+32-16,this.parent.y+32+16,1)),this.parent.x+=32,yield}for(yield*this.sleep(12),this.parent.x=i+Dt+32-(i+Dt+32-e)%6,this.parent.y=s;this.parent.x>e;)this.parent.x-=6,yield;this.parent.x=e,this.do_not_pop||this.parent.popState()}}t.AirRaidAttackState=c;class d extends e{init(){this.lockon=new l(this.parent,!0).move(),this.airraid=new c(this.parent,!0).move()}*move(){let t=0,e=!1,s=!1;for(;t<110;)e=this.lockon.next().done,yield,t++;for(;!e||!s;)e=this.lockon.next().done,s=this.airraid.next().done,yield;this.parent.popState()}}t.LockOnAndAirRaidAttack=d;class u extends o{init(){this.parent.sprite_normal.visible=!1,this.parent.sprite_damage.visible=!0}*update(){yield*this.sleep(16),this.parent.hp>0?(this.parent.shield.show(),yield*this.sleep(6,()=>this.parent.shield.update()),this.parent.sprite_normal.visible=!0,this.parent.sprite_damage.visible=!1,60===this.parent.hp?this.parent.setState(new s(this.parent)):40===this.parent.hp?this.parent.setState(new i(this.parent)):this.parent.popState()):(yield*this.sleep(8),this.parent.setState(new m(this.parent)))}}t.Damage=u;class m extends o{init(){this.parent.sprite_normal.visible=!1,this.parent.sprite_damage.visible=!1,this.parent.healthbar.container.visible=!1,this.parent.healthbar.kill()}*update(){yield*this.sleep(14),this.parent.api.jss.setStageClear(),this.parent.kill()}}t.Die=m}(lt||(lt={}));class xt extends c{constructor(t,e,s,i,a){super(t,e,s),this.rad=i,this.speed=a,this.sprite=new r.Sprite(t.api.resource.images.slit),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.rotation=i;const n=Math.random();this.sprite.scale.x=.1+.4*n,this.sprite.scale.y=.1+.4*n,this.sprite.blendMode=r.BLEND_MODES.ADD,this.container.addChild(this.sprite),this.setState(new ct.Default(this),!1)}}!function(t){(ct||(ct={})).Default=class extends o{init(){}*update(){const t=g;for(let e=0;e<=10;e++){const s=this.parent.speed*(1-t(e/10));this.parent.x+=Math.cos(this.parent.rad)*s,this.parent.y+=Math.sin(this.parent.rad)*s,this.parent.sprite.alpha=1-t(e/10),yield}}render(){}}}();class vt extends L{constructor(t,e,s,i=0,a=32,n=32,h=64,p=64,o=10){super(t,new r.Sprite(t.api.resource.images.shockwave_jaggy),e,s,i,a,n,h,p,o)}}class wt extends c{constructor(t,e,s){super(t,e,s),this.entities=new h(this.container),this.setState(new dt.Default(this),!1)}}!function(t){(dt||(dt={})).Default=class extends o{init(){}*update(){for(let t=0;t<2;t++){for(let e=0;e<30-12*t;e++)this.parent.entities.add(new xt(this.parent.level,0,0,2*Math.random()*Math.PI,12*(2-t)+28*(.4+.6*Math.random())));for(let e=0;e<2-t;e++){const t=32*(2*Math.random()+1)/3,e=96*(2*Math.random()+1)/3;this.parent.entities.add(new vt(this.parent.level,0,0,(2*Math.random()-1)*Math.PI/4,2*t,t,2*e,e))}this.parent.entities.update(),yield}for(;this.parent.entities.size>0;)this.parent.entities.update(),yield}render(){this.parent.entities.render()}}}();class St extends p{constructor(t){super(t);const{jss:e}=t;e.setMyMaxHP(kt),this.add(new x(this,kt)),this.add(new yt(this,416,512));const s=e.createPlayerEventEmitter();s.on("fumu",()=>{this.add(new wt(this,e.getMyXReal()+16,e.getMyYReal()+32))}),s.on("damage",(t,s,i)=>{const a=-1===e.getMyXReal()?s:e.getMyXReal(),n=-1===e.getMyYReal()?i:e.getMyYReal();this.add(new W(this,a+16,n,t))}),s.on("miss",()=>{e.removePlayerEventEmitter(s)})}}class bt extends c{constructor(t){super(t,Dt/2,Ct/2);const{resource:e}=this.api;this.sprite=new r.Sprite(e.images.ending),this.sprite.anchor.set(.5),this.sprite.alpha=.15,this.container.addChild(this.sprite),this.setState(new ut.Default(this),!1)}}!function(t){(ut||(ut={})).Default=class extends o{*update(){for(let t=0;t<20;t++)this.parent.sprite.scale.set(1+.5*t/20),this.parent.sprite.alpha=.3*(1-t/20),yield}}}();class Mt extends p{constructor(t){super(t),this.add(new bt(this))}}const kt=100,Dt=512,Ct=320;class jt{constructor(t,e,s){if(this.flg_initialized=!1,this.renderer=r.autoDetectRenderer({width:Dt,height:Ct}),this.renderer.type!==r.RENDERER_TYPE.WEBGL){const t=document.getElementById("webgl_message");null!==t&&(t.style.display="block")}const i=new r.Container;this.base_sprite=r.Sprite.from(e._ctx.canvas),this.base_ctx=e._ctx,i.addChild(this.base_sprite),this.api={jss:t,graphics:e,root:i,resource:s},this.mode=0,this.level=null}userJS(t){const e=this.mode;this.mode=t,this.flg_initialized||(this.flg_initialized=!0,this.userInitJS()),1===t?this.userTitleJS():t>=100&&t<200?this.api.jss.getJSMes()>=1?(this.api.jss.setJSMes(0),this.userGameStartJS()):this.userGameJS():200===t?this.userGameoverJS():300===t&&(t!==e?this.userEndingInitJS():this.userEndingJS()),this.render()}userInitJS(){}userTitleJS(){this.removeLevel()}userGameStartJS(){this.api.jss.removeAllPlayerEventEmitter(),this.level=new St(this.api)}userGameJS(){this.level.update()}userGameoverJS(){this.removeLevel()}userEndingInitJS(){this.removeLevel(),this.base_sprite.texture.update(),this.level=new Mt(this.api)}userEndingJS(){this.level.update()}removeLevel(){null!==this.level&&(this.level.kill(),this.level=null)}render(){null!==this.level&&this.level.render(),300!==this.mode&&this.base_sprite.texture.update(),this.renderer.render(this.api.root),this.base_ctx.drawImage(this.renderer.view,0,0)}}class At{constructor(t){this.callback=t}inject(t,e){const s=this,i=t.init_j;t.init_j=function(){i.apply(t),s.emit(t)}}emit(t){this.callback(t,t.gg.os_g_bk,t.masaoJSSAppletEmulator)}}class Et{inject(t,e){t.paint=function(t){this.mp.draw_lock_f||t.drawImage(this.gg.os_img,0,0)}}}var Pt=PIXI.utils.EventEmitter;class Rt{constructor(){this.event_emmiters=[]}inject(t,e){const s=this,i=t.userInit;t.userInit=function(){i.apply(t),s.player=Rt.getPlayerParams(t),s.player_prev=Rt.getPlayerParams(t),null!==t.masaoJSSAppletEmulator&&(t.masaoJSSAppletEmulator.createPlayerEventEmitter=(()=>s.create()),t.masaoJSSAppletEmulator.removePlayerEventEmitter=(t=>s.remove(t)),t.masaoJSSAppletEmulator.removeAllPlayerEventEmitter=(()=>s.removeAll()))};const a=t.userSub;t.userSub=function(e,i){a(e,i),s.watch(t)}}watch(t){this.player_prev=this.player,this.player=Rt.getPlayerParams(t);const e=this.player_prev,s=this.player;if((0===e.j_muteki_c&&s.j_muteki_c>0||e.j_hp!==s.j_hp&&s.j_hp<=0)&&this.emit("damage",e.j_hp-s.j_hp,e.co_j.x,e.co_j.y),e.j_muteki_c>0&&0===s.j_muteki_c&&(s.co_j.c<200||s.co_j.c>240)&&this.emit("muteki_end"),s.j_jump_type!==e.j_jump_type&&0===s.j_jump_type&&0!==s.j_jump_level&&this.emit("jump",s.j_jump_level),s.co_j.c!==e.co_j.c)switch(s.co_j.c){case 110:switch(s.co_j.vy){case-220:this.emit("fumu",2);break;case-320:this.emit("fumu",3);break;default:this.emit("fumu",1)}break;case 200:this.emit("miss",2);break;case 210:this.emit("miss",1);break;case 220:this.emit("miss",3);break;case 230:this.emit("miss",4);break;case 240:this.emit("miss",5)}}emit(t,...e){for(const s of this.event_emmiters)s.emit(t,...e)}create(){const t=new Pt;return this.event_emmiters.push(t),t}remove(t){for(let e=this.event_emmiters.length-1;e>=0;e--)if(this.event_emmiters[e]===t){this.event_emmiters.splice(e,1);break}}removeAll(){this.event_emmiters.length=0}static getPlayerParams(t){const{c:e,pt:s,x:i,y:a,vx:n,vy:r}=t.mp.co_j,{j_jump_level:h,j_jump_type:p,j_muteki_c:o,j_hp:l}=t.mp;return{j_jump_level:h,j_jump_type:p,j_muteki_c:o,j_hp:l,co_j:{c:e,pt:s,x:i,y:a,vx:n,vy:r}}}}const{params:Tt,"advanced-map":It}=i;!function(t,e,s){const i=new n;let a=null;new JSMasao(t,void 0,{userJSCallback:(t,e)=>{a.userJS(e)},extensions:[new At((t,e,n)=>{for(const{name:t,path:e}of s)r.loader.add(t,e);r.loader.load((t,s)=>{i.go(),a=new jt(n,e,new d(s))}),e._ctx.fillStyle="#000000",e._ctx.fillRect(0,0,Dt,Ct),e._ctx.fillStyle="#ffffff",e._ctx.font="16px sans-serif",e._ctx.fillText("ただいまファイルを読み込み中。しばらくお待ち下さい。",32,160)}),new Et,i,new Rt],"advance-map":e})}(Object.assign({},Tt,{score_v:2,now_loading:"ただいまファイルを読み込み中。しばらくお待ち下さい。",filename_ending:"assets/images/ending.gif",filename_gameover:"assets/images/gameover.gif",filename_haikei:"assets/images/haikei.gif",filename_haikei2:"assets/images/haikei.gif",filename_haikei3:"assets/images/haikei.gif",filename_haikei4:"assets/images/haikei.gif",filename_mapchip:"assets/images/mapchip.gif",filename_pattern:"assets/images/pattern.gif",filename_title:"assets/images/title.gif",se_switch:"1",se_filename:"2",filename_se_start:"assets/sounds/item.mp3",filename_se_gameover:"assets/sounds/gameover.mp3",filename_se_clear:"assets/sounds/clear.mp3",filename_se_coin:"assets/sounds/coin.mp3",filename_se_get:"assets/sounds/get.mp3",filename_se_item:"assets/sounds/item.mp3",filename_se_jump:"assets/sounds/jump.mp3",filename_se_sjump:"assets/sounds/sjump.mp3",filename_se_kiki:"assets/sounds/kiki.mp3",filename_se_fumu:"assets/sounds/fumu.mp3",filename_se_tobasu:"assets/sounds/tobasu.mp3",filename_se_fireball:"assets/sounds/shot.mp3",filename_se_jet:"assets/sounds/mgan.mp3",filename_se_miss:"assets/sounds/dosun.mp3",filename_se_block:"assets/sounds/bakuhatu.mp3",filename_se_mizu:"assets/sounds/mizu.mp3",filename_se_dengeki:"assets/sounds/mgan.mp3",filename_se_happa:"assets/sounds/happa.mp3",filename_se_hinoko:"assets/sounds/mgan.mp3",filename_se_mizudeppo:"assets/sounds/happa.mp3",filename_se_bomb:"assets/sounds/shot.mp3",filename_se_dosun:"assets/sounds/dosun.mp3",filename_se_grounder:"assets/sounds/mgan.mp3",filename_se_kaiole:"assets/sounds/happa.mp3",filename_se_senkuuza:"assets/sounds/shot.mp3",filename_se_dokan:"assets/sounds/get.mp3",filename_se_chizugamen:"assets/sounds/get.mp3"}),It,a)}]);